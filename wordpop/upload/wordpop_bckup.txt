<?php 
session_start();
$_SESSION['views']=$_SESSION['views']+1;
echo "<script type='text/javascript'>console.log(' number of views is ".$_SESSION["views"]."');</script>"; 
?>
<!DOCTYPE HTML>
<html>
<head>
<title>JavaScript Text Search</title>
<link rel="icon" href="/img/ninja.gif" type="img/ninja.gif" sizes="16x16" />
<link rel="stylesheet" type="text/css" href="/reset.css" />
<link rel="stylesheet" type="text/css" href="wordpop.css" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.cdnjs.com/ajax/libs/underscore.js/1.1.4/underscore-min.js"></script>
<script type="text/javascript" src="http://ajax.cdnjs.com/ajax/libs/backbone.js/0.3.3/backbone-min.js"></script>
</head>
<body>
<?php
/*
if ($_SESSION["file_name"]==$_FILES["file"]["name"]){ 
//echo '<meta http-equiv="refresh" content="0;url=common_room.php">';
}else
*/
{
echo "<script type='text/javascript'> \n";
if (isset ($_FILES["file"]))
{
	//echo "console.log('".$_FILES["file"]["type"]."');"; 
	
	//echo "console.log('".$_SESSION["file_name"]." is session file');"; 
	if ((($_FILES["file"]["type"] == "text/plain"))
	&& ($_FILES["file"]["size"] < 20000))
	  {
	  if ($_FILES["file"]["error"] > 0)
		{
		echo "console.log('Return Code: " . $_FILES["file"]["error"] . "');"; 
		}
	  else
		{
		
		//echo " Upload: " . $_FILES["file"]["name"] . "<br />";
		/*
		echo "Type: " . $_FILES["file"]["type"] . "<br />";
		echo "Size: " . ($_FILES["file"]["size"] / 1024) . " Kb<br />";
		echo "Temp file: " . $_FILES["file"]["tmp_name"] . "<br />";
		*/
		if (file_exists("upload/" . $_FILES["file"]["name"]))
		  {
		// echo $_FILES["file"]["name"] . " already exists. ";
		  }
		else
		  {
		  move_uploaded_file($_FILES["file"]["tmp_name"],
		  "upload/" . $_FILES["file"]["name"]);
		// echo "Stored in: " . "upload/" . $_FILES["file"]["name"];
		  }
		}
		
			  }
	else
	  {
	  echo "alert('Invalid file format Please choose Text file');";
	  }
   }
   echo "</script>";
}
echo "<script type='text/javascript'> \n";

echo "console.log('Acquiring the source file');
			function load_file(){ ";
			if (isset ($_FILES["file"]))
			{
echo 		"var file_name='upload/".$_FILES["file"]["name"]."';";
			}else{
echo		"var file_name='alice_in_wonderland.txt';";
			}
echo		"return file_name;}

			console.log(load_file()+' is loading....');
			if (typeof load_file() != 'undef'){
			$(document).ready(function (){jQuery.get(load_file(),function(data){jQuery('#text-body').text(data);});});
}";
/*
echo "console.log('".$_SESSION["file_name"]." is set to session file');"; 
if (!isset($_SESSION["file_name"])){
$_SESSION["file_name"]=$_FILES["file"]["name"]?$_FILES["file"]["name"]:"alice_in_wonderland.txt";
}
echo "console.log('".$_SESSION["file_name"]." is set to session file');"; 
*/
echo "</script>";
?>
<div class='full-body'>
<div class='heading'>
<span> Word pop with Numbers</span>
</div>
<pre id='text-body' class='text-class'></pre>
<div class='upload'>
<form id="uform" action="<? $_SERVER['PHP_SELF'] ?>" method="post"
enctype="multipart/form-data" style="display:none" >
<input type='file' name='file' id='file' value='Upload your file'/>
<input type='submit' value='submit'/>
</form>
<span id="ubutton" class='ubute bute'>Upload Your File</span>
</div>
<div id='match-list' class='list-class'>
<input type="text" placeholder="Enter number [2-9]" id="input_txt" />
<span id="input_number" class='sbute bute'>Enter</span>
<div class='match'>
<span class='list-heading'>Popular Prefix Matches</span>
<table id="result-list" class='result-class'>
<tr><td>No Results</td></tr>  
</table>
</div>
<div class='match'>
<span class='list-heading'>Popular Exact Matches</span>
<table id="result-list-2" class='result-class'>    
<tr><td>No Results</td></tr> 
</table>
</div>
</div>
</div>
<script type="text/javascript" src="wordpop.js"></script>
<script type='text/javascript'>

$("#file").change(function(){
	console.log('change called');
	if ($(this).val()){
	$("#uform").submit();
	}
});

$("#ubutton").click(function(){	
	$("#file").click();
});

</script>
</body>
</html>
